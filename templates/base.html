<!-- <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Библиотека</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
</head>

<body>
    <header class="position-fixed w-100">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Библиотека</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'main' %} active {% endif %}" href="#">Главная</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'books' %} active {% endif %}" href="#">Книги</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'readers' %} active {% endif %}" href="#">Читатели</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if current_page == 'book_issuance' %} active {% endif %}" href="#">Выдачи книг</a>
                        </li>
                </div>
            </div>
        </nav>


    </header>

    {% block content %}{% endblock %}

</body>

</html> -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система бронирования номеров</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        header h1 {
            margin: 0;
            text-align: center;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        table, th, td {
            border: 1px solid #ddd;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #3498db;
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        tr:hover {
            background-color: #e9e9e9;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .status-available {
            color: green;
            font-weight: bold;
        }
        
        .status-booked {
            color: red;
            font-weight: bold;
        }
        
        .status-maintenance {
            color: orange;
            font-weight: bold;
        }
        
        .search-container {
            margin-bottom: 20px;
        }
        
        .action-buttons button {
            margin-right: 5px;
        }
        
        .notification {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Система бронирования номеров</h1>
        </div>
    </header>
    
    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="openTab('rooms')">Номера</div>
            <div class="tab" onclick="openTab('guests')">Гости</div>
            <div class="tab" onclick="openTab('bookings')">Бронирования</div>
            <div class="tab" onclick="openTab('add-booking')">Новое бронирование</div>
        </div>
        
        <div id="notification" class="notification"></div>
        
        <!-- Вкладка Номера -->
        <div id="rooms" class="tab-content active">
            <div class="search-container">
                <input type="text" id="room-search" placeholder="Поиск по типу или статусу..." onkeyup="searchRooms()">
            </div>
            
            <table id="rooms-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Тип</th>
                        <th>Стоимость (за ночь)</th>
                        <th>Статус</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Данные будут загружены через JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Вкладка Гости -->
        <div id="guests" class="tab-content">
            <div class="search-container">
                <input type="text" id="guest-search" placeholder="Поиск по ФИО или паспорту..." onkeyup="searchGuests()">
            </div>
            
            <table id="guests-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ФИО</th>
                        <th>Паспорт</th>
                        <th>Контакты</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Данные будут загружены через JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Вкладка Бронирования -->
        <div id="bookings" class="tab-content">
            <div class="search-container">
                <input type="text" id="booking-search" placeholder="Поиск по номеру или гостю..." onkeyup="searchBookings()">
            </div>
            
            <table id="bookings-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Номер</th>
                        <th>Гость</th>
                        <th>Дата заезда</th>
                        <th>Дата выезда</th>
                        <th>Сумма</th>
                        <th>Статус оплаты</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Данные будут загружены через JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Вкладка Новое бронирование -->
        <div id="add-booking" class="tab-content">
            <h2>Новое бронирование</h2>
            
            <div class="form-group">
                <label for="booking-room">Номер:</label>
                <select id="booking-room">
                    <option value="">Выберите номер</option>
                    <!-- Опции будут загружены через JavaScript -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="booking-guest">Гость:</label>
                <select id="booking-guest">
                    <option value="">Выберите гостя</option>
                    <!-- Опции будут загружены через JavaScript -->
                </select>
                <button onclick="showAddGuestForm()">+ Добавить нового гостя</button>
            </div>
            
            <div class="form-group">
                <label for="check-in-date">Дата заезда:</label>
                <input type="date" id="check-in-date">
            </div>
            
            <div class="form-group">
                <label for="check-out-date">Дата выезда:</label>
                <input type="date" id="check-out-date">
            </div>
            
            <div class="form-group">
                <label for="payment-status">Статус оплаты:</label>
                <select id="payment-status">
                    <option value="Не оплачено">Не оплачено</option>
                    <option value="Частично оплачено">Частично оплачено</option>
                    <option value="Оплачено">Оплачено</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="total-amount">Общая сумма:</label>
                <input type="text" id="total-amount" readonly>
            </div>
            
            <button onclick="addBooking()">Забронировать</button>
            
            <!-- Форма добавления нового гостя (скрыта по умолчанию) -->
            <div id="add-guest-form" style="display: none; margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                <h3>Добавить нового гостя</h3>
                
                <div class="form-group">
                    <label for="guest-fio">ФИО:</label>
                    <input type="text" id="guest-fio">
                </div>
                
                <div class="form-group">
                    <label for="guest-passport">Паспортные данные:</label>
                    <input type="text" id="guest-passport">
                </div>
                
                <div class="form-group">
                    <label for="guest-contacts">Контактная информация:</label>
                    <input type="text" id="guest-contacts">
                </div>
                
                <button onclick="addGuest()">Добавить гостя</button>
                <button onclick="hideAddGuestForm()">Отмена</button>
            </div>
        </div>
    </div>
    
    <script>
        // Инициализация данных
        let rooms = [
            { id: 1, type: "Одноместный", price: 2500, status: "Доступен" },
            { id: 2, type: "Двухместный", price: 3500, status: "Доступен" },
            { id: 3, type: "Люкс", price: 5000, status: "Доступен" },
            { id: 4, type: "Одноместный", price: 2500, status: "На обслуживании" },
            { id: 5, type: "Президентский", price: 10000, status: "Забронирован" }
        ];
        
        let guests = [
            { id: 1, fio: "Иванов Иван Иванович", passport: "4510 123456", contacts: "+7 (123) 456-78-90" },
            { id: 2, fio: "Петров Петр Петрович", passport: "4511 654321", contacts: "petrov@example.com" },
            { id: 3, fio: "Сидорова Анна Владимировна", passport: "4512 987654", contacts: "+7 (987) 654-32-10" }
        ];
        
        let bookings = [
            { id: 1, roomId: 5, guestId: 1, checkIn: "2023-06-01", checkOut: "2023-06-10", amount: 90000, paymentStatus: "Оплачено" },
            { id: 2, roomId: 3, guestId: 3, checkIn: "2023-06-15", checkOut: "2023-06-20", amount: 25000, paymentStatus: "Частично оплачено" }
        ];
        
        // Загрузка данных при открытии страницы
        document.addEventListener('DOMContentLoaded', function() {
            loadRooms();
            loadGuests();
            loadBookings();
            loadRoomOptions();
            loadGuestOptions();
            
            // Установка минимальной даты для бронирования (сегодня)
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('check-in-date').min = today;
            document.getElementById('check-out-date').min = today;
        });
        
        // Функции для работы с вкладками
        function openTab(tabName) {
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // Функции для работы с номерами
        function loadRooms() {
            const tbody = document.querySelector('#rooms-table tbody');
            tbody.innerHTML = '';
            
            rooms.forEach(room => {
                const row = document.createElement('tr');
                
                let statusClass = '';
                if (room.status === 'Доступен') statusClass = 'status-available';
                else if (room.status === 'Забронирован') statusClass = 'status-booked';
                else if (room.status === 'На обслуживании') statusClass = 'status-maintenance';
                
                row.innerHTML = `
                    <td>${room.id}</td>
                    <td>${room.type}</td>
                    <td>${room.price} руб.</td>
                    <td class="${statusClass}">${room.status}</td>
                    <td class="action-buttons">
                        <button onclick="editRoom(${room.id})">Изменить</button>
                        <button onclick="deleteRoom(${room.id})">Удалить</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function searchRooms() {
            const input = document.getElementById('room-search').value.toLowerCase();
            const rows = document.querySelectorAll('#rooms-table tbody tr');
            
            rows.forEach(row => {
                const type = row.cells[1].textContent.toLowerCase();
                const status = row.cells[3].textContent.toLowerCase();
                
                if (type.includes(input) || status.includes(input)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function editRoom(id) {
            const room = rooms.find(r => r.id === id);
            if (room) {
                const newType = prompt('Тип номера:', room.type);
                if (newType !== null) {
                    const newPrice = prompt('Стоимость:', room.price);
                    if (newPrice !== null) {
                        const newStatus = prompt('Статус (Доступен/Забронирован/На обслуживании):', room.status);
                        if (newStatus !== null) {
                            room.type = newType;
                            room.price = parseInt(newPrice);
                            room.status = newStatus;
                            loadRooms();
                            loadRoomOptions();
                            showNotification('Номер успешно обновлен', 'success');
                        }
                    }
                }
            }
        }
        
        function deleteRoom(id) {
            if (confirm('Вы уверены, что хотите удалить этот номер?')) {
                const index = rooms.findIndex(r => r.id === id);
                if (index !== -1) {
                    // Проверка, есть ли активные бронирования для этого номера
                    const hasBookings = bookings.some(b => b.roomId === id);
                    
                    if (hasBookings) {
                        showNotification('Нельзя удалить номер с активными бронированиями', 'error');
                    } else {
                        rooms.splice(index, 1);
                        loadRooms();
                        loadRoomOptions();
                        showNotification('Номер успешно удален', 'success');
                    }
                }
            }
        }
        
        // Функции для работы с гостями
        function loadGuests() {
            const tbody = document.querySelector('#guests-table tbody');
            tbody.innerHTML = '';
            
            guests.forEach(guest => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${guest.id}</td>
                    <td>${guest.fio}</td>
                    <td>${guest.passport}</td>
                    <td>${guest.contacts}</td>
                    <td class="action-buttons">
                        <button onclick="editGuest(${guest.id})">Изменить</button>
                        <button onclick="deleteGuest(${guest.id})">Удалить</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function searchGuests() {
            const input = document.getElementById('guest-search').value.toLowerCase();
            const rows = document.querySelectorAll('#guests-table tbody tr');
            
            rows.forEach(row => {
                const fio = row.cells[1].textContent.toLowerCase();
                const passport = row.cells[2].textContent.toLowerCase();
                
                if (fio.includes(input) || passport.includes(input)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function editGuest(id) {
            const guest = guests.find(g => g.id === id);
            if (guest) {
                const newFio = prompt('ФИО:', guest.fio);
                if (newFio !== null) {
                    const newPassport = prompt('Паспортные данные:', guest.passport);
                    if (newPassport !== null) {
                        const newContacts = prompt('Контактная информация:', guest.contacts);
                        if (newContacts !== null) {
                            guest.fio = newFio;
                            guest.passport = newPassport;
                            guest.contacts = newContacts;
                            loadGuests();
                            loadGuestOptions();
                            showNotification('Данные гостя успешно обновлены', 'success');
                        }
                    }
                }
            }
        }
        
        function deleteGuest(id) {
            if (confirm('Вы уверены, что хотите удалить этого гостя?')) {
                const index = guests.findIndex(g => g.id === id);
                if (index !== -1) {
                    // Проверка, есть ли активные бронирования для этого гостя
                    const hasBookings = bookings.some(b => b.guestId === id);
                    
                    if (hasBookings) {
                        showNotification('Нельзя удалить гостя с активными бронированиями', 'error');
                    } else {
                        guests.splice(index, 1);
                        loadGuests();
                        loadGuestOptions();
                        showNotification('Гость успешно удален', 'success');
                    }
                }
            }
        }
        
        // Функции для работы с бронированиями
        function loadBookings() {
            const tbody = document.querySelector('#bookings-table tbody');
            tbody.innerHTML = '';
            
            bookings.forEach(booking => {
                const row = document.createElement('tr');
                
                const room = rooms.find(r => r.id === booking.roomId);
                const guest = guests.find(g => g.id === booking.guestId);
                
                const roomInfo = room ? `${room.type} (№${room.id})` : 'Номер не найден';
                const guestInfo = guest ? guest.fio : 'Гость не найден';
                
                row.innerHTML = `
                    <td>${booking.id}</td>
                    <td>${roomInfo}</td>
                    <td>${guestInfo}</td>
                    <td>${formatDate(booking.checkIn)}</td>
                    <td>${formatDate(booking.checkOut)}</td>
                    <td>${booking.amount} руб.</td>
                    <td>${booking.paymentStatus}</td>
                    <td class="action-buttons">
                        <button onclick="editBooking(${booking.id})">Изменить</button>
                        <button onclick="deleteBooking(${booking.id})">Удалить</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function searchBookings() {
            const input = document.getElementById('booking-search').value.toLowerCase();
            const rows = document.querySelectorAll('#bookings-table tbody tr');
            
            rows.forEach(row => {
                const room = row.cells[1].textContent.toLowerCase();
                const guest = row.cells[2].textContent.toLowerCase();
                
                if (room.includes(input) || guest.includes(input)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function editBooking(id) {
            const booking = bookings.find(b => b.id === id);
            if (booking) {
                const newCheckIn = prompt('Дата заезда (ГГГГ-ММ-ДД):', booking.checkIn);
                if (newCheckIn !== null) {
                    const newCheckOut = prompt('Дата выезда (ГГГГ-ММ-ДД):', booking.checkOut);
                    if (newCheckOut !== null) {
                        const newPaymentStatus = prompt('Статус оплаты:', booking.paymentStatus);
                        if (newPaymentStatus !== null) {
                            // Проверка дат
                            if (new Date(newCheckOut) <= new Date(newCheckIn)) {
                                showNotification('Дата выезда должна быть позже даты заезда', 'error');
                                return;
                            }
                            
                            booking.checkIn = newCheckIn;
                            booking.checkOut = newCheckOut;
                            booking.paymentStatus = newPaymentStatus;
                            
                            // Пересчет суммы
                            const room = rooms.find(r => r.id === booking.roomId);
                            if (room) {
                                const nights = getNightsBetweenDates(newCheckIn, newCheckOut);
                                booking.amount = nights * room.price;
                            }
                            
                            loadBookings();
                            showNotification('Бронирование успешно обновлено', 'success');
                        }
                    }
                }
            }
        }
        
        function deleteBooking(id) {
            if (confirm('Вы уверены, что хотите удалить это бронирование?')) {
                const index = bookings.findIndex(b => b.id === id);
                if (index !== -1) {
                    // Освобождаем номер
                    const booking = bookings[index];
                    const room = rooms.find(r => r.id === booking.roomId);
                    if (room) {
                        room.status = 'Доступен';
                    }
                    
                    bookings.splice(index, 1);
                    loadBookings();
                    loadRooms();
                    showNotification('Бронирование успешно удалено', 'success');
                }
            }
        }
        
        // Функции для добавления нового бронирования
        function loadRoomOptions() {
            const select = document.getElementById('booking-room');
            select.innerHTML = '<option value="">Выберите номер</option>';
            
            rooms.forEach(room => {
                if (room.status === 'Доступен') {
                    const option = document.createElement('option');
                    option.value = room.id;
                    option.textContent = `${room.type} (№${room.id}) - ${room.price} руб./ночь`;
                    select.appendChild(option);
                }
            });
        }
        
        function loadGuestOptions() {
            const select = document.getElementById('booking-guest');
            select.innerHTML = '<option value="">Выберите гостя</option>';
            
            guests.forEach(guest => {
                const option = document.createElement('option');
                option.value = guest.id;
                option.textContent = `${guest.fio} (${guest.passport})`;
                select.appendChild(option);
            });
        }
        
        function showAddGuestForm() {
            document.getElementById('add-guest-form').style.display = 'block';
        }
        
        function hideAddGuestForm() {
            document.getElementById('add-guest-form').style.display = 'none';
            // Очищаем поля формы
            document.getElementById('guest-fio').value = '';
            document.getElementById('guest-passport').value = '';
            document.getElementById('guest-contacts').value = '';
        }
        
        function addGuest() {
            const fio = document.getElementById('guest-fio').value.trim();
            const passport = document.getElementById('guest-passport').value.trim();
            const contacts = document.getElementById('guest-contacts').value.trim();
            
            if (!fio || !passport || !contacts) {
                showNotification('Все поля должны быть заполнены', 'error');
                return;
            }
            
            // Проверяем, нет ли уже гостя с таким паспортом
            const guestExists = guests.some(g => g.passport === passport);
            if (guestExists) {
                showNotification('Гость с таким паспортом уже существует', 'error');
                return;
            }
            
            // Генерируем новый ID
            const newId = guests.length > 0 ? Math.max(...guests.map(g => g.id)) + 1 : 1;
            
            const newGuest = {
                id: newId,
                fio: fio,
                passport: passport,
                contacts: contacts
            };
            
            guests.push(newGuest);
            loadGuests();
            loadGuestOptions();
            hideAddGuestForm();
            
            // Выбираем нового гостя в форме бронирования
            document.getElementById('booking-guest').value = newId;
            
            showNotification('Новый гость успешно добавлен', 'success');
        }
        
        function addBooking() {
            const roomId = parseInt(document.getElementById('booking-room').value);
            const guestId = parseInt(document.getElementById('booking-guest').value);
            const checkIn = document.getElementById('check-in-date').value;
            const checkOut = document.getElementById('check-out-date').value;
            const paymentStatus = document.getElementById('payment-status').value;
            
            if (!roomId || !guestId || !checkIn || !checkOut) {
                showNotification('Все поля должны быть заполнены', 'error');
                return;
            }
            
            // Проверка дат
            if (new Date(checkOut) <= new Date(checkIn)) {
                showNotification('Дата выезда должна быть позже даты заезда', 'error');
                return;
            }
            
            // Находим номер
            const room = rooms.find(r => r.id === roomId);
            if (!room) {
                showNotification('Выбранный номер не найден', 'error');
                return;
            }
            
            // Проверяем, доступен ли номер
            if (room.status !== 'Доступен') {
                showNotification('Выбранный номер недоступен для бронирования', 'error');
                return;
            }
            
            // Проверяем, нет ли пересечений с другими бронированиями
            const hasConflict = bookings.some(b => {
                return b.roomId === roomId && (
                    (new Date(checkIn) >= new Date(b.checkIn) && (new Date(checkIn) < new Date(b.checkOut)) ||
                    (new Date(checkOut) > new Date(b.checkIn) && (new Date(checkOut) <= new Date(b.checkOut)) ||
                    (new Date(checkIn) <= new Date(b.checkIn) && (new Date(checkOut) >= new Date(b.checkOut))
                ))));
            });
            
            if (hasConflict) {
                showNotification('На выбранные даты номер уже забронирован', 'error');
                return;
            }
            
            // Рассчитываем количество ночей и сумму
            const nights = getNightsBetweenDates(checkIn, checkOut);
            const amount = nights * room.price;
            
            // Генерируем новый ID для бронирования
            const newId = bookings.length > 0 ? Math.max(...bookings.map(b => b.id)) + 1 : 1;
            
            // Создаем новое бронирование
            const newBooking = {
                id: newId,
                roomId: roomId,
                guestId: guestId,
                checkIn: checkIn,
                checkOut: checkOut,
                amount: amount,
                paymentStatus: paymentStatus
            };
            
            bookings.push(newBooking);
            
            // Меняем статус номера
            room.status = 'Забронирован';
            
            // Обновляем таблицы
            loadBookings();
            loadRooms();
            loadRoomOptions();
            
            // Очищаем форму
            document.getElementById('booking-room').value = '';
            document.getElementById('booking-guest').value = '';
            document.getElementById('check-in-date').value = '';
            document.getElementById('check-out-date').value = '';
            document.getElementById('payment-status').value = 'Не оплачено';
            document.getElementById('total-amount').value = '';
            
            showNotification('Номер успешно забронирован', 'success');
        }
        
        // Вспомогательные функции
        function formatDate(dateString) {
            const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
            return new Date(dateString).toLocaleDateString('ru-RU', options);
        }
        
        function getNightsBetweenDates(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const diffTime = end - start;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }
        
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
        
        // Обработчики событий для расчета суммы при изменении дат или номера
        document.getElementById('booking-room').addEventListener('change', calculateTotal);
        document.getElementById('check-in-date').addEventListener('change', function() {
            const checkIn = this.value;
            const checkOut = document.getElementById('check-out-date');
            
            if (checkIn && checkOut.value && new Date(checkOut.value) <= new Date(checkIn)) {
                checkOut.value = '';
                document.getElementById('total-amount').value = '';
            } else {
                calculateTotal();
            }
        });
        
        document.getElementById('check-out-date').addEventListener('change', function() {
            const checkOut = this.value;
            const checkIn = document.getElementById('check-in-date').value;
            
            if (checkOut && checkIn && new Date(checkOut) <= new Date(checkIn)) {
                showNotification('Дата выезда должна быть позже даты заезда', 'error');
                this.value = '';
                document.getElementById('total-amount').value = '';
            } else {
                calculateTotal();
            }
        });
        
        function calculateTotal() {
            const roomId = parseInt(document.getElementById('booking-room').value);
            const checkIn = document.getElementById('check-in-date').value;
            const checkOut = document.getElementById('check-out-date').value;
            
            if (roomId && checkIn && checkOut) {
                const room = rooms.find(r => r.id === roomId);
                if (room) {
                    const nights = getNightsBetweenDates(checkIn, checkOut);
                    document.getElementById('total-amount').value = `${nights * room.price} руб. (${nights} ночей)`;
                }
            }
        }
    </script>
</body>
</html>